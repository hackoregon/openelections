language: node_js
  - "11.4.0"

services:
  - docker

# cache:
#   directories:
#     - app/node_modules

before_install:
  - docker-compose -f docker-compose-test.yml pull
  - docker-compose -f docker-compose-test.yml build api
  - docker-compose -f docker-compose-test.yml build data
  - docker-compose -f docker-compose-test.yml build app

script:
  - docker-compose -f docker-compose-test.yml run --rm api npm test
  # data science tests don't exist yet, reactivate when they do
  # - docker-compose -f docker-compose-test.yml run --rm data make test
  - docker-compose -f docker-compose-test.yml run --rm app yarn test

#before_deploy:
#  - sudo add-apt-repository -y ppa:eugenesan/ppa
#  - sudo apt-get update -y
#  - sudo apt-get install jq -y
#  - pip install --user awscli

#deploy:
#  provider: script
#  script: bash scripts/deploy.sh
#  skip_cleanup: true
#  on:
#    branch: develop
